<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/Plugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/Plugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * MLJLib
 * MeshLabJS Library
 * 
 * Copyright(C) 2015
 * Paolo Cignoni 
 * Visual Computing Lab
 * ISTI - CNR
 * 
 * All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify it under 
 * the terms of the GNU General Public License as published by the Free Software 
 * Foundation; either version 2 of the License, or (at your option) any later 
 * version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT 
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS 
 * FOR A PARTICULAR PURPOSE. See theGNU General Public License 
 * (http://www.gnu.org/licenses/gpl.txt) for more details.
 * 
 */

/**
 * @file Defines the basic classes and functions to manage and to create plugins
 * @author Stefano Gabriele
 */

/**
 * MLJ.core.plugin namespace
 * @namespace MLJ.core.plugin
 * @memberOf MLJ.core
 * @author Stefano Gabriele
 */
MLJ.core.plugin = {
    /**
      * Enum for plugin types values.
      * @readonly
      * @enum {Integer}
      * @memberOf MLJ.core
      * @author Stefano Gabriele 
     */
    types: {
        /** Filter type value*/
        FILTER: 0,
        /** Rendering type value*/
        RENDERING: 1
    }
};

/**         
 * @class Defines a generic plugin
 * @param {Integer} type The type of plugin, i.e. &lt;code>MLJ.core.plugin.type.FILTER&lt;/code>
 * or &lt;code>MLJ.core.plugin.type.RENDERING&lt;/code>
 * @param {String} name The name of plugin
 * @memberOf MLJ.core.plugin
 * @author Stefano Gabriele 
 */
MLJ.core.plugin.Plugin = function (type, name) {
    this.type = type;
    this.name = name;
};

MLJ.core.plugin.Plugin.prototype = {
    /**
     * Returns the name of plugin               
     * @returns {String} The name of plugin
     * @author Stefano Gabriele
     */
    getName: function () {
        return this.name;
    },
    /**
     * This function should be overridden to define the plugin GUI and its initialization stuff
     * @param {MLJ.core.plugin.GUIBuilder} guiBuilder The object that provides 
     * useful function to build the GUI quickly
     * @abstract     
     * @author Stefano Gabriele
     */
    _init: function (guiBuilder) {
    },
    /**
     * This function should be overridden to define the code that will
     * be executed after that apply or apply to all visible buttons was clicked
     * @param {MLJ.core.MeshFile} meshFile The mesh file that should be affected
     * by the code defined in this function
     * @abstract       
     * @author Stefano Gabriele
     */
    _applyTo: function (meshFile) {
    },
    /**
     * This function represents the main entry point for the plugin execution
     * @abstract      
     * @author Stefano Gabriele
     */
    _main: function () {
    }
};

/**         
 * @class Creates a new GUI builder object, this is the base class used to build
 * GUIs for filters and rendering features
 * @param {MLJ.gui.component.Component} component The base GUI component where 
 * append the MeshLabJs widgets 
 * @memberOf MLJ.core.plugin
 * @author Stefano Gabriele 
 */
MLJ.core.plugin.GUIBuilder = function (component) {    
    this.Float = function (flags) {
        var float = new MLJ.gui.MLWidget.Float(flags);
        component.appendContent(float._make());
        return float;
    };
    this.Integer = function (flags) {
        var integer = new MLJ.gui.MLWidget.Integer(flags);
        component.appendContent(integer._make());
        return integer;
    };
    this.Bool = function (flags) {
        var bool = new MLJ.gui.MLWidget.Bool(flags);
        component.appendContent(bool._make());
        return bool;
    };
    this.Choice = function (flags) {
        var choice = new MLJ.gui.MLWidget.Choice(flags);
        component.appendContent(choice._make());
        return choice;
    };
    this.Color = function (flags) {
        var color = new MLJ.gui.MLWidget.Color(flags);
        component.appendContent(color._make());
        return color;
    };
};

MLJ.core.plugin.RenderingBarBuilder = function (tb) {
    this.Toggle = function (flags) {
        var toggle = MLJ.gui.build.ToggleButton(flags);
        tb.addButton(toggle);

        if (flags.onToggle !== undefined) {
            toggle.onToggle(function (on) {
                flags.onToggle(on);                
            });
        }

        return toggle;
    };
};

/**         
 * @class Creates a new filter
 * @param {Object} parameters The object contains the initialization parameters 
 * to create filter plugin&lt;br>
 * &lt;code> paramters = {&lt;br>
 * &amp;nbsp name: //the name of filter&lt;br> 
 * &amp;nbsp tooltip: //the filter description shown if mouse pointer is 
 * over its name&lt;br>
 * &amp;nbsp arity: //An integer:&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp //0 for a creation filter&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp //1 for a generic filter &lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp //>1 if the filter doesn't use the current mesh but 
 * defines its own meshes&lt;br>
 * }
 * &lt;/code>
 * @memberOf MLJ.core.plugin 
 * @author Stefano Gabriele 
 * @example
 * &lt;caption>Refine Filter&lt;/caption>
 * (function (plugin, scene) {
 *
 *      var filter = new plugin.Filter({
 *          name: "Refine",
 *          tooltip: "Apply a subdvision surface refinement step, using various approach (midpoint/loop)",
 *          arity: 1
 *      });
 *
 *      var iterWdg;
 *      filter._init = function (builder) {
 *
 *          iterWdg = builder.Integer({
 *              max: 5, min: 1, step: 1, defval: 1,
 *              label: "Step",
 *              tooltip: "How many refinement iterations are applied to the mesh"
 *          });
 *
 *      };
 *
 *      filter._applyTo = function (meshFile) {
 *          Module.RefineMesh(meshFile.ptrMesh,iterWdg.getValue());
 *          scene.updateLayer(meshFile);
 *      };
 *
 *      plugin.install(filter);
 *
 * })(MLJ.core.plugin, MLJ.core.Scene);
 */
MLJ.core.plugin.Filter = function (parameters) {
    MLJ.core.plugin.Plugin.call(this, MLJ.core.plugin.types.FILTER
            , parameters.name, parameters.tooltip, parameters.arity);
    var _this = this;

    var entry = new MLJ.gui.build.AccordionEntry(
            {label: parameters.name, tooltip: parameters.tooltip});

    //Test if arity is number and is integer
    if (!(Math.floor(parameters.arity) === parameters.arity &amp;&amp;
            jQuery.isNumeric(parameters.arity))) {
        parameters.arity = 1;
    }

    var filterBuilder = new MLJ.core.plugin.GUIBuilder(entry);

    $(document).on("mljSearchSelect", function (ev, select) {
        var found = false;

        for (var i = 0, m = select.length; i &lt; m; i++) {

            if (parameters.name.includes(select[i])) {
                entry.show();
                found = true;
                //exit from for cycle
                i = select.length;
            }
        }

        if (!found) {
            entry.hide();
        }

        MLJ.widget.TabbedPane.getFiltersAccord().refresh();
    });

    this._main = function () {
        MLJ.widget.TabbedPane.getFiltersAccord().addEntry(entry);

        var apply = MLJ.gui.build.Button({
            tooltip: "Apply to selected layer",
            icon: "img/icons/apply.png",
        });

        entry.addHeaderButton(apply);

        apply.onClick(function () {
            var meshFile = MLJ.core.Scene.getSelectedLayer();
            var t0 = performance.now();
            _this._applyTo(meshFile);
            var t1 = performance.now();
            MLJ.widget.Log.append(name + " exectution time " + Math.round(t1 - t0) + " ms");
        });

        if (parameters.arity > 0) {
            MLJ.gui.disabledOnSceneEmpty(apply);
        }

        if (parameters.arity === 1) {
            var applyAll = MLJ.gui.build.Button({
                tooltip: "Apply to all visible layers",
                icon: "img/icons/apply_all.png",
            });
            entry.addHeaderButton(applyAll);

            MLJ.gui.disabledOnSceneEmpty(applyAll);

            applyAll.onClick(function () {
                var ptr = MLJ.core.Scene.getLayers().iterator();
                var layer;
                var t0 = performance.now();
                while (ptr.hasNext()) {
                    layer = ptr.next();
                    if (layer.getThreeMesh().visible) {
                        _this._applyTo(layer);
                    }
                }
                var t1 = performance.now();
                MLJ.widget.Log.append(name + " exectution time " + Math.round(t1 - t0) + " ms");
            });
        }

        _this._init(filterBuilder);
    };
};

/**         
 * @class Creates a new rendering feature
 * @param {Object} parameters The object contains the initialization parameters 
 * to create a rendering plugin&lt;br>
 * &lt;code> paramters = {&lt;br>
 * &amp;nbsp name: //the name of rendering feature&lt;br>
 * &amp;nbsp button: { //rendering tool bar button definition&lt;br> 
 * &amp;nbsp&amp;nbsp&amp;nbsp type: //button type ("toggle")&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp tooltip: //button tooltip&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp icon: //button image path&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp on: //default button status (only for toggle button)&lt;br>
 * &amp;nbsp&amp;nbsp&amp;nbsp onToggle: //the function to perform on toggle event (only for toggle button)&lt;br>
 * &amp;nbsp&amp;nbsp}&lt;br>        
 * }
 * &lt;/code>
 * @memberOf MLJ.core.plugin 
 * @author Stefano Gabriele 
 * @example
 * &lt;caption>Ambient light feature&lt;/caption>
 * (function (plugin, core, scene) {
 *  
 *      var plug = new plugin.Rendering({
 *          name: "Ambient Light",
 *          button: {
 *              type: "toggle",
 *              tooltip: "Ambient light on/off",
 *              icon: "img/icons/light.png",
 *              on: core.defaults.AmbientLight.on,
 *              onToggle: function(on) {                
 *                  scene.lights.AmbientLight.setOn(on);
 *              }
 *          }        
 *      });
 *       
 *      plug._init = function (guiBuilder) {
 *          guiBuilder.Color({
 *              label: "Color",
 *              tooltip: "Ambient light color",
 *              color: core.defaults.AmbientLight.color,
 *              onChange: function (hex) {
 *                  scene.lights.AmbientLight.setColor('#' + hex);
 *              }
 *          });
 *
 *      };
 *       
 *      plugin.install(plug);
 *      
 *})(MLJ.core.plugin, MLJ.core, MLJ.core.Scene);
 */
MLJ.core.plugin.Rendering = function (parameters) {
    MLJ.core.plugin.Plugin.call(this, MLJ.core.plugin.types.RENDERING,
            parameters.name);
    var _this = this;

    var pane = MLJ.gui.build.Pane();
    var UID = MLJ.gui.generateUID();
    pane.$.css("position", "absolute").attr("id", UID);

    var guiBuilder = new MLJ.core.plugin.GUIBuilder(pane);
    var tbBuilder = new MLJ.core.plugin.RenderingBarBuilder(
            MLJ.widget.TabbedPane.getRendToolBar());
    var renderingPane = MLJ.widget.TabbedPane.getRenderingPane();

    if (parameters.button.type === "toggle") {
        var btn = tbBuilder.Toggle(parameters.button);

        $(document).ready(function () {
            $(this).on("contextmenu", function (e) {
                if (btn.$.find("img").prop("outerHTML") === $(e.target).prop("outerHTML")) {
                    e.preventDefault();
                }
            });
        });

        btn.$.focus(function (ev) {
            ev.preventDefault();

            renderingPane.children().each(function (key, val) {
                if ($(val).attr("id") === UID) {
                    $(val).fadeIn();
                } else {
                    $(val).fadeOut();
                }
            });

        });
    }

    this._main = function () {
        _this._init(guiBuilder);
        renderingPane.append(pane.$);
    };

};

MLJ.extend(MLJ.core.plugin.Plugin, MLJ.core.plugin.Filter);
MLJ.extend(MLJ.core.plugin.Plugin, MLJ.core.plugin.Rendering);

(function (widget, gui) {

    var _plugins = new MLJ.util.AssociativeArray();
    
    /**
     * Installs a new plugin in MeshLabJS
     * @memberOf MLJ.core.plugin
     * @author Stefano Gabriele
     */
    this.install = function () {
        var plugin;
        var search = MLJ.gui.getWidget("SearchTool");
        for (var i = 0; i &lt; arguments.length; i++) {
            plugin = arguments[i];
            if (plugin instanceof MLJ.core.plugin.Plugin) {
                _plugins.set(plugin.getName(), plugin);
                search.addItem(plugin.getName());
            } else {
                console.error("The parameter must be an instance of MLJ.core.Plugin");
            }
        }
    };
    
    /**
     * Executes the main entry point function for all installed plugins
     * @memberOf MLJ.core.plugin
     * @author Stefano Gabriele
     */
    this.run = function () {
        var ptr = _plugins.iterator();
        while (ptr.hasNext()) {
            ptr.next()._main();
        }
    };

}).call(MLJ.core.plugin, MLJ.widget, MLJ.gui);//MLJ.widget contains GUI running widgets</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MLJ.core.AmbientLight.html">AmbientLight</a></li><li><a href="MLJ.core.Headlight.html">Headlight</a></li><li><a href="MLJ.core.MeshFile.html">MeshFile</a></li><li><a href="MLJ.core.PhongMaterial.html">PhongMaterial</a></li><li><a href="MLJ.core.plugin.Filter.html">Filter</a></li><li><a href="MLJ.core.plugin.GUIBuilder.html">GUIBuilder</a></li><li><a href="MLJ.core.plugin.Plugin.html">Plugin</a></li><li><a href="MLJ.core.plugin.Rendering.html">Rendering</a></li><li><a href="MLJ.Error.html">Error</a></li><li><a href="MLJ.gui.widget._Info.html">_Info</a></li><li><a href="MLJ.gui.widget._LayersPane.html">_LayersPane</a></li><li><a href="MLJ.gui.widget._Log.html">_Log</a></li><li><a href="MLJ.gui.widget._Logo.html">_Logo</a></li><li><a href="MLJ.gui.widget.Widget.html">Widget</a></li><li><a href="MLJ.util.AssociativeArray.html">AssociativeArray</a></li><li><a href="MLJ.util.AssociativeArray-_Iterator.html">_Iterator</a></li></ul><h3>Events</h3><ul><li><a href="MLJ.core.File.html#event:MeshFileOpened">MeshFileOpened</a></li><li><a href="MLJ.core.File.html#event:MeshFileReloaded">MeshFileReloaded</a></li><li><a href="MLJ.core.Scene.html#event:SceneLayerAdded">SceneLayerAdded</a></li><li><a href="MLJ.core.Scene.html#event:SceneLayerSelected">SceneLayerSelected</a></li><li><a href="MLJ.core.Scene.html#event:SceneLayerUpdated">SceneLayerUpdated</a></li></ul><h3>Namespaces</h3><ul><li><a href="MLJ.html">MLJ</a></li><li><a href="MLJ.core.html">core</a></li><li><a href="MLJ.core.File.html">File</a></li><li><a href="MLJ.core.plugin.html">plugin</a></li><li><a href="MLJ.core.Scene.html">Scene</a></li><li><a href="MLJ.gui.html">gui</a></li><li><a href="MLJ.gui.widget.html">widget</a></li><li><a href="MLJ.util.html">util</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Module">Module</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Tue Jun 30 2015 00:35:16 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
